# Hook System Reference

Comprehensive automation system for SolarWindPy development workflow.

## Hook Types and Triggers

### SessionStart Hooks
- **Trigger**: Every Claude Code session startup
- **Script**: `.claude/hooks/validate-session-state.sh`
- **Purpose**: Branch validation, context loading, plan status
- **Timeout**: 30 seconds

### UserPromptSubmit Hooks  
- **Trigger**: Prompts containing "*plan*"
- **Script**: `.claude/hooks/git-workflow-validator.sh --enforce-branch`
- **Purpose**: Workflow enforcement on plan-related activities
- **Timeout**: 15 seconds

### PreToolUse Hooks
- **Bash Tool**: Git workflow validation for git/gh commands
- **Edit/MultiEdit/Write Tools**: Physics validation before file changes
- **Script**: `.claude/hooks/physics-validation.py`
- **Timeout**: 45 seconds for physics validation

### PostToolUse Hooks
- **Trigger**: After Edit/MultiEdit/Write operations
- **Script**: `.claude/hooks/test-runner.sh --changed`
- **Purpose**: Smart test execution for modified files
- **Timeout**: 120 seconds

### PreCompact Hooks
- **Trigger**: Token boundary approaching
- **Script**: `.claude/hooks/create-compaction.py` 
- **Purpose**: Session state preservation
- **Timeout**: 30 seconds

### Stop Hooks
- **Trigger**: Session end
- **Script**: `.claude/hooks/coverage-monitor.py`
- **Purpose**: Final coverage analysis and reporting
- **Timeout**: 60 seconds

## Key Hook Scripts

### Session Management
- `validate-session-state.sh` - Branch validation and context loading
- `git-workflow-validator.sh` - Branch protection and workflow enforcement
- `create-compaction.py` - Token limit management with state preservation

### Quality Assurance  
- `test-runner.sh` - Smart test execution with multiple modes
- `coverage-monitor.py` - Detailed coverage analysis and reporting
- `pre-commit-tests.sh` - Automated testing before commits
- `physics-validation.py` - Domain-specific constraint checking

### Planning & Documentation
- `plan-value-generator.py` - Auto-generates comprehensive value propositions
- `plan-scope-auditor.py` - Validates scientific focus alignment
- `plan-value-validator.py` - Ensures plan completeness

## Test Runner Modes

```bash
.claude/hooks/test-runner.sh --changed     # Test only changed files
.claude/hooks/test-runner.sh --physics     # Physics validation tests  
.claude/hooks/test-runner.sh --coverage    # Full coverage report
.claude/hooks/test-runner.sh --fast        # Quick test run
.claude/hooks/test-runner.sh --all         # Complete test suite
```

## Physics Validation

```bash
python .claude/hooks/physics-validation.py                    # Current changes
python .claude/hooks/physics-validation.py solarwindpy/**/*.py # Specific files
python .claude/hooks/physics-validation.py --strict           # Strict mode
python .claude/hooks/physics-validation.py --report           # Generate report
python .claude/hooks/physics-validation.py --fix             # Auto-fix issues
```

## Plan Value Propositions

Required sections auto-generated by hooks:
- üìä **Value Proposition Analysis**: Development and productivity value
- üí∞ **Resource & Cost Analysis**: ROI calculations  
- ‚ö†Ô∏è **Risk Assessment & Mitigation**: Technical and workflow risks
- üîí **Security Proposition**: Code-level security (NO FAIR compliance)
- üéØ **Scope Audit**: SolarWindPy alignment validation (‚â•80/100 score)
- üíæ **Token Usage Optimization**: Session efficiency metrics
- ‚è±Ô∏è **Time Investment Analysis**: Development time breakdown
- üéØ **Usage & Adoption Metrics**: Success criteria

## Session State Management

### Compaction Pattern
- **Location**: `.claude/compacted_state.md` and timestamped backups
- **Format**: `compaction-{date}-{time}-{compression}pct.md`
- **Purpose**: File-based session state preservation at token boundaries
- **Benefits**: 60-80% token savings through automated compression

### Coverage Monitoring
- **Requirement**: ‚â•95% coverage enforced
- **Integration**: Pre-commit hook validation
- **Reporting**: Detailed analysis via coverage-monitor.py
- **Templates**: Smart test generation via generate-test.py

## Hook Configuration

All hooks are configured in `.claude/settings.json` with:
- **Matchers**: Pattern-based trigger conditions
- **Timeouts**: Maximum execution time limits
- **Blocking**: Whether execution blocks tool use
- **Arguments**: Dynamic parameter passing

## Automation Benefits
- **Token Optimization**: 60-80% reduction in planning overhead
- **Quality Assurance**: Automatic validation prevents broken code
- **Workflow Enforcement**: Branch protection and test requirements
- **Scientific Rigor**: Physics constraint validation
- **Multi-computer Sync**: Instant plan access across machines