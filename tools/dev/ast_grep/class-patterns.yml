# SolarWindPy Class Patterns - ast-grep Rules
# Mode: Advisory (warn only, do not block)
#
# These rules detect common class usage patterns and suggest
# SolarWindPy-idiomatic practices.
#
# Usage: sg scan --config tools/dev/ast_grep/class-patterns.yml solarwindpy/

rules:
  # ===========================================================================
  # Rule 1: Plasma constructor requires species
  # ===========================================================================
  - id: swp-class-001
    language: python
    severity: warning
    message: |
      Plasma constructor requires species argument(s).
      Example: Plasma(data, 'p1', 'a')
    note: |
      The Plasma class needs at least one species specified.
      Use: Plasma(data, 'p1') or Plasma(data, 'p1', 'a')
    pattern: Plasma($data)

  # ===========================================================================
  # Rule 2: Ion constructor requires species
  # ===========================================================================
  - id: swp-class-002
    language: python
    severity: warning
    message: |
      Ion constructor requires species as second argument.
      Example: Ion(data, 'p1')
    note: |
      Ion class needs data and a single species identifier.
      Species cannot contain '+' (use Plasma for multi-species).
    pattern: Ion($data)

  # ===========================================================================
  # Rule 3: Spacecraft requires name and frame
  # ===========================================================================
  - id: swp-class-003
    language: python
    severity: warning
    message: |
      Spacecraft constructor requires (data, name, frame).
      Example: Spacecraft(data, 'PSP', 'HCI')
    note: |
      Valid names: PSP, WIND
      Valid frames: HCI, GSE
    pattern: Spacecraft($data)

  # ===========================================================================
  # Rule 4: xs() should specify axis and level
  # ===========================================================================
  - id: swp-class-004
    language: python
    severity: warning
    message: |
      .xs() should specify axis and level for clarity.
      Example: data.xs('p1', axis=1, level='S')
    note: |
      Explicit axis and level prevents ambiguity with MultiIndex data.
    pattern: $var.xs($key)

  # ===========================================================================
  # Rule 5: Use super().__init__() in class constructors
  # ===========================================================================
  - id: swp-class-005
    language: python
    severity: info
    message: |
      SolarWindPy classes should call super().__init__() to initialize
      logger, units, and constants from Core base class.
    note: |
      The Core class provides _init_logger(), _init_units(), _init_constants().
    pattern: |
      def __init__(self, $$$args):
          $$$body

  # ===========================================================================
  # Rule 6: Plasma attribute access via __getattr__
  # ===========================================================================
  - id: swp-class-006
    language: python
    severity: info
    message: |
      Plasma supports species attribute access via __getattr__.
      plasma.p1 is equivalent to plasma.ions.loc['p1']
    note: |
      Use plasma.p1 for cleaner code instead of plasma.ions.loc['p1'].
    pattern: $plasma.ions.loc[$species]
