# Plan: Create Conda-Forge Feedstock for SolarWindPy

## Overview
Create a conda-forge feedstock to distribute SolarWindPy through the conda package manager, making it easily installable for the scientific Python community.

## Phase 1: Prerequisites & Preparation
1. **Ensure PyPI Release**: Verify SolarWindPy has a stable release on PyPI (required for conda-forge)
2. **License Verification**: ✅ BSD-3-Clause license in LICENSE.rst is properly formatted
3. **PyProject.toml Status**: ✅ Classifiers have been corrected (License classifier is now valid)
4. **Install Tools**: 
   - Install `grayskull` for automatic recipe generation: `conda install conda-forge::grayskull`
   - Install `conda-smithy` for recipe validation: `conda install conda-forge::conda-smithy`

## Phase 2: Generate Initial Recipe
1. **Auto-generate Recipe**: Use grayskull to create initial conda recipe:
   ```bash
   grayskull pypi solarwindpy
   ```
2. **Recipe Review**: Examine generated `meta.yaml` for accuracy and completeness
3. **PyProject.toml Compatibility**: ✅ No issues - recent fixes make the package conda-ready

## Phase 3: Recipe Customization
1. **Optimize Recipe Structure**:
   - Set `noarch: python` for pure Python package
   - Use standard `pip install . -vv` build command
   - Add comprehensive test imports for all major modules
   - Include `pip check` in test commands

2. **Dependencies Mapping** (from pyproject.toml):
   ```yaml
   run:
     - python >=3.10,<4
     - numpy
     - scipy
     - pandas
     - numexpr
     - bottleneck
     - h5py
     - pyyaml
     - matplotlib
     - astropy
     - numba
     - tabulate
   ```

3. **Build System Compatibility**:
   - Use setuptools_scm for version management (already configured)
   - Ensure setuptools>=61 requirement is met
   - Handle dynamic versioning correctly in conda recipe

## Phase 4: Submit to Staged-Recipes
1. **Fork Repository**: Fork `conda-forge/staged-recipes`
2. **Create Recipe Directory**: Add recipe in `recipes/solarwindpy/`
3. **Include Required Files**:
   - `meta.yaml` (or `recipe.yaml` for v1 format)
   - Copy `LICENSE.rst` as `LICENSE`
   - No additional build scripts needed (pure Python)

4. **Validate Recipe**: Run conda-smithy lint checks locally
5. **Submit PR**: Open pull request to conda-forge/staged-recipes

## Phase 5: Review Process & Maintenance
1. **Address Feedback**: Work with conda-forge reviewers to refine recipe
2. **CI Validation**: Ensure recipe builds successfully on all platforms
3. **Accept Maintainer Role**: Commit to maintaining the feedstock
4. **Auto-Updates**: Configure for automatic version updates via conda-forge bots

## Expected Recipe Structure
```yaml
{% raw %}
{% set name = "solarwindpy" %}
{% set version = "0.1.0" %}  # Will use latest PyPI version

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: # Auto-generated by grayskull

build:
  number: 0
  noarch: python
  script: {{ PYTHON }} -m pip install . -vv

requirements:
  host:
    - python >=3.10,<4
    - pip
    - setuptools >=61
    - setuptools_scm
    - wheel
  run:
    - python >=3.10,<4
    - numpy
    - scipy  
    - pandas
    - numexpr
    - bottleneck
    - h5py
    - pyyaml
    - matplotlib
    - astropy
    - numba
    - tabulate

test:
  imports:
    - solarwindpy
    - solarwindpy.core
    - solarwindpy.plotting
    - solarwindpy.fitfunctions
    - solarwindpy.instabilities
    - solarwindpy.solar_activity
    - solarwindpy.tools
  commands:
    - pip check
  requires:
    - pip

about:
  home: https://github.com/blalterman/SolarWindPy
  license: BSD-3-Clause
  license_file: LICENSE.rst
  summary: Python package for solar wind data analysis.
  description: |
    SolarWindPy provides tools for analyzing in-situ solar wind measurements,
    including multi-species plasma analysis, magnetic field calculations,
    and plasma instability studies.

extra:
  recipe-maintainers:
    - blalterman  # GitHub username
{% endraw %}
```

## Key Advantages (Based on Current pyproject.toml)
1. **Clean Dependencies**: All dependencies are available on conda-forge
2. **Proper Metadata**: License, classifiers, and project URLs are correctly specified
3. **Modern Build System**: Uses pyproject.toml with setuptools_scm
4. **Version Constraints**: Python 3.10+ requirement aligns with conda-forge standards
5. **Scientific Focus**: Clear scientific computing package classification

## Timeline & Expectations
- **Phase 1-2**: 1-2 hours (preparation and recipe generation)
- **Phase 3**: 2-3 hours (customization and testing)
- **Phase 4**: 1 hour (submission)
- **Phase 5**: 1-2 weeks (review process, varies with reviewer availability)

## Success Criteria
1. Recipe builds successfully on all conda-forge CI platforms
2. All tests pass during conda-forge validation
3. Package installs and imports correctly via conda
4. Feedstock is created and maintained automatically
5. SolarWindPy becomes available via: `conda install conda-forge::solarwindpy`

## Maintenance Commitment
As maintainer, responsibilities include:
- Merging bot PRs for version updates
- Responding to build failures and dependency issues
- Updating recipe for major changes in package structure
- Providing community support for conda installation issues

## Notes
- The recent pyproject.toml fixes eliminate potential conda-forge submission issues
- No additional packaging preparation is needed - the package is conda-ready
- setuptools_scm configuration will work seamlessly with conda-forge's build system